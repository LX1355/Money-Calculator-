<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© - Ø³Ø­Ø§Ø¨ÙŠ</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #27ae60;
            --bg-color: #f4f7f6;
            --danger-color: #e74c3c;
            --accent-color: #2980b9;
            --warning-color: #f39c12;
        }
        
        * { font-family: 'Cairo', 'Segoe UI', Tahoma, sans-serif; box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; margin: 0; touch-action: manipulation;
            overflow-x: hidden; /* Ù„Ù…Ù†Ø¹ Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø² Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
        }

        .input-error {
            border: 2px solid var(--danger-color) !important;
            box-shadow: 0 0 5px rgba(231, 76, 60, 0.3);
            background-color: #fff5f5;
        }

        .swal2-popup { border-radius: 15px !important; padding: 1.5rem !important; }

        @keyframes pulse-generic {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.2); }
            50% { transform: scale(1.02); }
            70% { box-shadow: 0 0 0 10px rgba(0, 0, 0, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 0, 0, 0); }
        }

        .pulse-blue-btn { animation: pulse-generic 2s infinite; background: var(--accent-color) !important; color: white !important; }
        .pulse-gray-btn { animation: pulse-generic 2s infinite; background: #ddd !important; color: #333 !important; }
        
        .pulse-in-green { animation: pulse-generic 2s infinite; box-shadow: 0 0 0 0 rgba(39, 174, 96, 0.7); }
        .pulse-in-orange { animation: pulse-generic 2s infinite; box-shadow: 0 0 0 0 rgba(243, 156, 18, 0.7); }
        .pulse-in-red { animation: pulse-generic 2s infinite; box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
        .pulse-in-gray { animation: pulse-generic 2s infinite; box-shadow: 0 0 0 0 rgba(189, 195, 199, 0.7); }

        @keyframes pulse-blue {
            0% { box-shadow: 0 0 0 0 rgba(41, 128, 185, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(41, 128, 185, 0); }
            100% { box-shadow: 0 0 0 0 rgba(41, 128, 185, 0); }
        }
        @keyframes pulse-red-confirm {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }

        .filter-tab.active-tab { 
            background: var(--accent-color); 
            color: white; 
            border-color: var(--accent-color);
            animation: pulse-blue 1.5s infinite;
        }

        .swal-pulse-confirm { animation: pulse-blue 1.5s infinite !important; }
        .swal-pulse-cancel { animation: pulse-red-confirm 1.5s infinite !important; }

        .login-screen { position: fixed; inset: 0; background: var(--bg-color); display: flex; justify-content: center; align-items: center; z-index: 9999; overflow-y: auto; }
        .login-box { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 85%; max-width: 320px; text-align: center; }
        .pin-input { width: 100%; padding: 12px; margin: 20px 0; border: 2px solid #ddd; border-radius: 12px; font-size: 1.2rem; text-align: center; box-sizing: border-box; transition: border-color 0.3s ease; }

        #mainApp { display: none; width: 100%; justify-content: center; padding: 20px 0; }
        .card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 95%; max-width: 380px; position: relative; max-height: 90vh; display: flex; flex-direction: column; }
        
        .settings-icon { position: absolute; top: 20px; right: 20px; cursor: pointer; font-size: 22px; color: #95a5a6; z-index: 10; }
        
        .user-header { text-align: center; margin-bottom: 5px; flex-shrink: 0; }
        .user-name { color: #7f8c8d; font-size: 1rem; margin: 0; }
        .total-label { color: #95a5a6; font-size: 0.85rem; margin-top: 2px; font-weight: bold; }
        .total-amount { font-size: 2.3rem; font-weight: 800; color: var(--primary-color); margin: 5px 0; text-align: center; flex-shrink: 0; }
        
        /* Ø¥Ø¶Ø§ÙØ© ØªÙ…Ø±ÙŠØ± Ù„Ø´Ø¨ÙƒØ© Ø§Ù„ÙØ¦Ø§Øª */
        .grid-container { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 8px; 
            overflow-y: auto; 
            padding: 5px; 
            margin-bottom: 10px;
            flex-grow: 1;
        }
        .money-box { background: #fff; border: 1px solid #e0e6ed; border-radius: 12px; padding: 15px; text-align: center; cursor: pointer; font-weight: bold; transition: 0.2s; border: 1px solid #ddd; }
        .money-box:active { transform: scale(0.95); background: #f0f0f0; }

        .action-row { display: flex; gap: 8px; margin-top: auto; flex-shrink: 0; }
        .btn-small { flex: 1; padding: 12px; border-radius: 10px; background: #eee; border: 1px solid #ccc; cursor: pointer; font-weight: bold; text-align: center; transition: all 0.3s ease; }
        
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0.7); transform: scale(1); }
            50% { box-shadow: 0 0 0 10px rgba(39, 174, 96, 0); transform: scale(1.05); }
            100% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0); transform: scale(1); }
        }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); transform: scale(1); }
            50% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); transform: scale(1.05); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); transform: scale(1); }
        }

        .active-deposit { background-color: var(--primary-color) !important; color: white !important; border:none; animation: pulse-green 1.5s infinite; }
        .active-withdraw { background-color: var(--danger-color) !important; color: white !important; border:none; animation: pulse-red 1.5s infinite; }

        /* Ø¥Ø¶Ø§ÙØ© ØªÙ…Ø±ÙŠØ± Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        .settings-menu { 
            display: none; 
            position: absolute; 
            top: 55px; 
            right: 20px; 
            background: white; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.15); 
            border-radius: 10px; 
            z-index: 100; 
            width: 170px; 
            border: 1px solid #eee; 
            max-height: 300px; 
            overflow-y: auto; 
        }
        .settings-menu button { background: none; border: none; padding: 12px; width: 100%; text-align: right; cursor: pointer; border-bottom: 1px solid #eee; font-family: inherit; }
        
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; overflow-y: auto; }
        .modal-content { background: white; margin: 3vh auto; width: 95%; max-width: 550px; border-radius: 15px; overflow: hidden; position: relative; display: flex; flex-direction: column; max-height: 94vh; }
        .modal-header { padding: 15px; background: #f8f9fa; display: flex; justify-content: space-between; font-weight: bold; border-bottom: 1px solid #eee; flex-shrink: 0;}
        
        .log-filter-tabs { display: flex; padding: 10px; background: #fff; gap: 8px; border-bottom: 1px solid #eee; flex-shrink: 0; }
        .filter-tab { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; text-align: center; cursor: pointer; font-size: 0.9rem; font-weight: bold; color: #555; transition: 0.3s; }

        .table-container { overflow-y: auto; padding: 10px; flex-grow: 1; }
        table { width: 100%; border-collapse: collapse; font-size: 0.75rem; }
        th, td { padding: 10px 2px; border-bottom: 1px solid #eee; text-align: center; }

        .admin-form { padding: 15px; background: #f9f9f9; border-radius: 10px; margin-bottom: 15px; border: 1px solid #eee; flex-shrink: 0; }
        .admin-form input { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; transition: border-color 0.3s ease; }
        
        .btn-save-user { border: none; padding: 12px; width: 100%; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        
        .edit-cell { position: relative; display: inline-block; padding-left: 5px; }
        .dot { position: absolute; top: -2px; left: -8px; width: 7px; height: 7px; background-color: var(--warning-color); border-radius: 50%; display: none; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
        .has-desc .dot { display: block; animation: blink 1s infinite ease-in-out; }

        .single-input-wrapper { display: flex; flex-direction: row-reverse; align-items: center; background: #fff; border: 2px solid #ddd; border-radius: 12px; margin: 10px 0; overflow: hidden; height: 48px; }
        .single-input-wrapper input { border: none; padding: 10px 15px; flex: 1; outline: none; font-size: 1rem; direction: rtl; font-family: inherit; }
        .quick-toggle-unit { background: #f0f2f5; min-width: 75px; height: 100%; display: flex; align-items: center; justify-content: center; cursor: pointer; border-right: 2px solid #ddd; user-select: none; }
        .quick-toggle-unit span { font-weight: 900; color: var(--accent-color); font-size: 0.9rem; }
        .quick-toggle-unit b { font-size: 0.7rem; margin-right: 4px; color: #888; }

        .return-bar { background: var(--warning-color); color: white; text-align: center; padding: 10px; font-weight: bold; cursor: pointer; display: none; position: fixed; bottom: 0; left: 0; right: 0; z-index: 2000; }
        
        .perm-select { padding: 4px; border-radius: 6px; border: 1px solid #ddd; font-size: 0.7rem; background: #fff; cursor: pointer; }

        .cust-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
        .move-btns { display: flex; gap: 5px; }
        .move-btns button { padding: 5px 8px; border: 1px solid #ddd; background: #fff; border-radius: 5px; cursor: pointer; }
        .support-msg { color: var(--danger-color); font-size: 0.85rem; margin-top: 10px; display: none; font-weight: bold; }

        .color-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; padding: 10px; max-height: 350px; overflow-y: auto; }
        .color-box { aspect-ratio: 1; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; cursor: pointer; font-size: 0.8rem; border: 1px solid rgba(0,0,0,0.1); }

        .admin-seen-cell { font-size: 0.65rem; line-height: 1.2; }
        .admin-seen-cell span { display: block; color: #888; font-size: 0.6rem; }
        .log-date-full { font-size: 0.6rem; white-space: nowrap; }

        /* ØªØ¬Ù…ÙŠÙ„ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #999; }
    </style>
</head>
<body>

<div id="loginScreen" class="login-screen">
    <div class="login-box">
        <h3>Ù…Ø­ÙØ¸Ø©</h3>
        <p>Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„</p> 
        <input type="password" id="pinInp" class="pin-input" maxlength="20" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø²">
        <button onclick="handleLogin(1)" class="pulse-in-green" style="width:100%; padding:12px; background:var(--primary-color); color:white; border:none; border-radius:10px; font-weight:bold;">Ø¯Ø®ÙˆÙ„</button>
        <p onclick="showBackup()" style="color:var(--accent-color); margin-top:15px; cursor:pointer;">Ù‡Ù„ Ù†Ø³ÙŠØª Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ØŸ</p>
    </div>
</div>

<div id="backupLoginScreen" class="login-screen" style="display:none;">
    <div class="login-box">
        <h3>Ù…Ø­ÙØ¸Ø©</h3>
        <p>Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</p>
        <input type="password" id="pinInp2" class="pin-input" maxlength="20" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ">
        <button onclick="handleLogin(2)" class="pulse-in-orange" style="width:100%; padding:12px; background:var(--warning-color); color:white; border:none; border-radius:10px; font-weight:bold;">Ø¯Ø®ÙˆÙ„</button>
        <p onclick="hideBackup()" style="color:#999; margin-top:15px; cursor:pointer;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø®Ù„Ù</p>
        <p onclick="showSupportMsg()" style="color:var(--accent-color); margin-top:10px; cursor:pointer; font-size: 0.9rem;">Ù‡Ù„ Ù†Ø³ÙŠØª Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØŸ</p>
        <div id="supportMsg" class="support-msg">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù…: 92986161</div>
    </div>
</div>

<div id="mainApp">
    <div class="card">
        <div class="settings-icon" onclick="toggleMenu()">âš™ï¸</div>
        <div id="mainMenu" class="settings-menu">
            <button onclick="openModal('logModal'); renderLogs();">Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</button>
            <button onclick="openModal('invModal'); renderInv();">Ø¹Ø¯Ø¯ Ø§Ù„ÙØ¦Ø©</button>
            <button onclick="openModal('profitModal'); resetProfitCalc();">Ø®Ø³Ø§Ø±Ø© Ùˆ Ø±Ø¨Ø­</button>
            <button onclick="openModal('changePinModal')">ØªØºÙŠÙŠØ± Ø±Ù…Ø²ÙŠ</button>
            <button id="adminBtn" style="display:none; color:var(--accent-color);" onclick="openModal('adminModal'); renderAdmin();">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
            <button id="custBtn" style="display:none; color:var(--accent-color); font-weight:bold;" onclick="openModal('custModal'); renderCustList();">ØªØ®ØµÙŠØµ</button>
            <button onclick="confirmResetWallet()" style="color:var(--danger-color);">ØªØµÙÙŠØ± Ø§Ù„Ù…Ø­ÙØ¸Ø©</button>
            <button onclick="location.reload()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
        </div>

        <div class="user-header">
            <p class="user-name" id="userTitle">Ù…Ø­ÙØ¸Ø©: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</p>
            <div class="total-label">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
        </div>
        
        <div class="total-amount" id="totalDisplay">0.000</div>
        
        <div class="grid-container" id="mainGrid"></div>
        
        <div class="action-row">
            <button id="btnDep" class="btn-small" onclick="changeMode('deposit')">ØªÙ… Ø¥ÙŠØ¯Ø§Ø¹</button>
            <button id="btnWith" class="btn-small" onclick="changeMode('withdraw')">ØªÙ… Ø®ØµÙ…</button>
        </div>
    </div>
</div>

<div id="returnBar" class="return-bar" onclick="stopRemoteSession()">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ø±Ø¶: Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ù„Ø¹ÙˆØ¯Ø© Ù„Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ø£ØµÙ„ÙŠ</div>

<div id="logModal" class="modal">
    <div class="modal-content">
        <div class="modal-header"><span>Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</span><span onclick="closeModal('logModal')" style="cursor:pointer">âœ•</span></div>
        <div class="log-filter-tabs">
            <div id="tab-all" class="filter-tab active-tab" onclick="setLogFilter('all')">Ø§Ù„ÙƒÙ„</div>
            <div id="tab-deposit" class="filter-tab" onclick="setLogFilter('deposit')">Ø¥ÙŠØ¯Ø§Ø¹ ÙÙ‚Ø·</div>
            <div id="tab-withdraw" class="filter-tab" onclick="setLogFilter('withdraw')">Ø®ØµÙ… ÙÙ‚Ø·</div>
        </div>
        <div class="table-container"><table><thead><tr><th>ÙˆØµÙ</th><th>Ø§Ù„ÙŠÙˆÙ…</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„ÙØ¦Ø©</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th></tr></thead><tbody id="logBody"></tbody></table></div>
    </div>
</div>

<div id="profitModal" class="modal">
    <div class="modal-content">
        <div class="modal-header"><span>Ø®Ø³Ø§Ø±Ø© Ùˆ Ø±Ø¨Ø­</span><span onclick="closeModal('profitModal')" style="cursor:pointer">âœ•</span></div>
        <div class="log-filter-tabs">
            <div id="p-tab-all" class="filter-tab active-tab" onclick="setProfitFilter('all')">Ø§Ù„ÙƒÙ„</div>
            <div id="p-tab-deposit" class="filter-tab" onclick="setProfitFilter('deposit')">Ø¥ÙŠØ¯Ø§Ø¹ ÙÙ‚Ø·</div>
            <div id="p-tab-withdraw" class="filter-tab" onclick="setProfitFilter('withdraw')">Ø®ØµÙ… ÙÙ‚Ø·</div>
        </div>
        <div class="table-container">
            <div style="background:#f9f9f9; padding:15px; border-radius:12px; border:1px solid #eee; margin-bottom:10px;">
                <p style="margin:0 0 10px; font-weight:bold; font-size:0.9rem;">Ø¨Ø­Ø« Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¯Ø©</p>
                <div class="single-input-wrapper">
                    <select id="profitPeriod" onchange="calculateProfit()" style="background:#f0f2f5; border:none; height:100%; min-width:85px; font-family:inherit; font-weight:bold; cursor:pointer; text-align:center;">
                        <option value="day">ÙŠÙˆÙ…</option>
                        <option value="month">Ø´Ù‡Ø±</option>
                        <option value="year">Ø³Ù†Ø©</option>
                    </select>
                    <input type="number" id="profitVal" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù…" oninput="calculateProfit()">
                </div>
                <div id="profitResult" style="text-align:center; padding:10px; margin-top:10px; border-radius:8px; font-weight:bold; display:none;"></div>
            </div>
            <table><thead><tr><th>Ø§Ù„ÙŠÙˆÙ…</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„ÙØ¦Ø©</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th></tr></thead><tbody id="profitBody"></tbody></table>
        </div>
    </div>
</div>

<div id="invModal" class="modal"><div class="modal-content"><div class="modal-header"><span>Ø¹Ø¯Ø¯ Ø§Ù„ÙØ¦Ø©</span><span onclick="closeModal('invModal')">âœ•</span></div><div class="table-container"><table><thead><tr><th>Ø§Ù„ÙØ¦Ø©</th><th>Ø§Ù„Ø¹Ø¯Ø¯</th><th>Ø§Ù„ØµØ§ÙÙŠ</th></tr></thead><tbody id="invBody"></tbody></table></div></div></div>

<div id="changePinModal" class="modal">
    <div class="modal-content" style="max-width:320px; padding:20px; text-align:center; margin: 20vh auto;">
        <h3>ØªØºÙŠÙŠØ± Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
        <input type="password" id="updPin1" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¬Ø¯ÙŠØ¯" class="pin-input" style="margin:10px 0;">
        <div style="display:flex; gap:10px; margin-top:10px;">
            <button onclick="closeModal('changePinModal')" class="pulse-in-gray" style="flex:1; padding:10px; border:none; border-radius:10px; background:#eee;">Ø¥Ù„ØºØ§Ø¡</button>
            <button onclick="updateMyPin()" class="pulse-in-green" style="flex:1; padding:10px; border:none; border-radius:10px; background:var(--primary-color); color:white;">ØªØ­Ø¯ÙŠØ«</button>
        </div>
    </div>
</div>

<div id="adminModal" class="modal"><div class="modal-content"><div class="modal-header"><span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span><span onclick="closeModal('adminModal')" style="cursor:pointer">âœ•</span></div><div class="table-container"><div class="admin-form"><p id="formTitle" style="margin:0 0 10px; font-weight:bold;">+ Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</p><input type="text" id="newName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
    
    <input type="text" id="newPin1" placeholder="Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ù…Ø·ÙˆØ±" oninput="this.classList.remove('input-error')">
    <input type="text" id="newPin2" placeholder="Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ" oninput="this.classList.remove('input-error')">
    
    <button class="btn-save-user pulse-blue-btn" id="adminSubmitBtn" onclick="saveUser()">Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</button>
    <button id="cancelEditBtn" onclick="resetAdminForm()" class="pulse-gray-btn" style="display:none; width:100%; margin-top:10px; border:none; padding:12px; border-radius:8px; font-weight:bold;">Ø¥Ù„ØºØ§Ø¡</button>

</div><table><thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th><th>Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ±</th><th>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</th><th>ØªØ¹Ø¯ÙŠÙ„</th><th>Ø­Ø°Ù</th></tr></thead><tbody id="adminBody"></tbody></table></div></div></div>

<div id="custModal" class="modal"><div class="modal-content"><div class="modal-header"><span>ØªØ®ØµÙŠØµ (Ø¹Ø§Ù… Ù„Ù„Ø¬Ù…ÙŠØ¹)</span><span onclick="closeModal('custModal')" style="cursor:pointer">âœ•</span></div><div class="table-container">
    <div style="background:#f9f9f9; padding:15px; border-radius:12px; border:1px solid #eee;">
        <p style="margin:0; font-weight:bold; font-size:0.9rem;">+ Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹</p>
        <div class="single-input-wrapper"><div class="quick-toggle-unit" onclick="toggleUnit()"><span id="currentUnit">Ø¨ÙŠØ³Ø©</span><b>â‡…</b></div><input type="number" id="custValue"></div>
        <button onclick="addNewCategory()" class="btn-save-user pulse-in-green" style="background:var(--primary-color); color:white;">Ø¥Ø¶Ø§ÙØ© Ù„Ù„ÙƒÙ„</button>
        <button onclick="deleteAllCats()" class="pulse-in-red" style="width:100%; margin-top:10px; padding:8px; background:none; border:1px dashed var(--danger-color); color:var(--danger-color); border-radius:8px; font-weight:bold; cursor:pointer;">ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª Ù…Ù† Ø§Ù„Ø¬Ù…ÙŠØ¹</button>
    </div>
    <div id="custListBody" style="margin-top:15px;"></div>
</div></div></div>

<div id="editNoteModal" class="modal"><div class="modal-content" style="max-width:300px; padding:20px; text-align:center; margin: 20vh auto;"><h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø©</h3><input type="text" id="noteInput" style="width:90%; padding:10px; margin:10px 0; border:1px solid #ddd; border-radius:10px;"><div style="display:flex; gap:10px;"><button onclick="closeModal('editNoteModal')" style="flex:1; padding:10px; border:none; border-radius:10px;">Ø¥Ù„ØºØ§Ø¡</button><button onclick="saveNote()" style="flex:1; padding:10px; border:none; border-radius:10px; background:var(--primary-color); color:white;">Ø­ÙØ¸</button></div></div></div>

<script>
    // Ø§Ù„Ø¥Ø¨Ù‚Ø§Ø¡ Ø¹Ù„Ù‰ Ù†ÙØ³ ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚
    const firebaseConfig = {
        apiKey: "AIzaSyCD70vCvODz90ItiLAqEm6SpwgZ2RVnW2c",
        authDomain: "wallet-e0832.firebaseapp.com",
        projectId: "wallet-e0832",
        storageBucket: "wallet-e0832.firebasestorage.app",
        messagingSenderId: "1080828882598",
        appId: "1:1080828882598:web:e9a6dc78bbda7e3b5bce67",
        databaseURL: "https://wallet-e0832-default-rtdb.firebaseio.com"
    };

    firebase.initializeApp(firebaseConfig);
    const dbRef = firebase.database().ref('wallets_v1');

    const presetColors = [];
    for (let i = 0; i < 100; i++) {
        const hue = (i * 13.7) % 360; 
        presetColors.push(`hsl(${hue}, 70%, 55%)`);
    }

    let db = [];
    let user = null;
    let originalAdmin = null; 
    let remoteMode = null;    
    let mode = '';
    let selectedUnit = 'Ø¨ÙŠØ³Ø©';
    let editingUserIdx = null;
    let activeLogId = null;
    let currentLogFilter = 'all';
    let currentProfitFilter = 'all';

    dbRef.on('value', (snapshot) => {
        const data = snapshot.val();
        db = Array.isArray(data) ? data : [];
        if (user) {
            const updatedUser = db.find(u => u.pin === user.pin);
            if(updatedUser){
                user = updatedUser;
                updateUI();
                renderMainGrid();
                if(document.getElementById('logModal').style.display === 'block') renderLogs();
                if(document.getElementById('custModal').style.display === 'block') renderCustList();
                if(document.getElementById('adminModal').style.display === 'block') renderAdmin();
                if(document.getElementById('profitModal').style.display === 'block') calculateProfit();
            }
        }
    });

    function saveDB() { dbRef.set(db); }

    function handleLogin(type) {
        const inputField = type === 1 ? document.getElementById('pinInp') : document.getElementById('pinInp2');
        const pinVal = inputField.value.trim();
        if (pinVal === "") { Swal.fire({ icon: 'warning', title: 'ØªÙ†Ø¨ÙŠÙ‡', text: 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø£ÙˆÙ„Ø§Ù‹' }); return; }
        const found = db.find(u => type === 1 ? u.pin === pinVal : u.pin2 === pinVal);
        if (found) {
            user = found;
            const now = new Date();
            const dateStr = now.toLocaleDateString('ar-EG');
            const timeStr = now.toLocaleTimeString('ar-EG', {hour:'2-digit', minute:'2-digit'});
            user.lastSeen = dateStr + "|" + timeStr; 
            saveDB();
            if(!user.logs) user.logs = [];
            if(!user.inv) user.inv = {};
            if(!user.cats) user.cats = []; 
            document.querySelectorAll('.login-screen').forEach(s => s.style.display='none');
            document.getElementById('mainApp').style.display='flex';
            document.getElementById('userTitle').innerText = "Ù…Ø­ÙØ¸Ø©: " + user.name;
            if(user.isAdmin) { document.getElementById('adminBtn').style.display='block'; document.getElementById('custBtn').style.display='block'; }
            updateUI(); renderMainGrid(); changeMode('deposit');
            Swal.fire({ icon: 'success', title: 'ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„', timer: 1000, showConfirmButton: false });
        } else { Swal.fire({ icon: 'error', title: 'Ø§Ù„Ø±Ù…Ø² Ø®Ø§Ø·Ø¦', text: 'ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø±Ù…Ø² ÙˆØ­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹' }); inputField.value = ''; }
    }

    function setLogFilter(f) {
        currentLogFilter = f;
        document.querySelectorAll('#logModal .filter-tab').forEach(t => t.classList.remove('active-tab'));
        document.getElementById('tab-' + f).classList.add('active-tab');
        renderLogs();
    }

    function setProfitFilter(f) {
        currentProfitFilter = f;
        document.querySelectorAll('#profitModal .filter-tab').forEach(t => t.classList.remove('active-tab'));
        document.getElementById('p-tab-' + f).classList.add('active-tab');
        calculateProfit();
    }

    function calculateProfit() {
        const num = parseFloat(document.getElementById('profitVal').value);
        const period = document.getElementById('profitPeriod').value;
        const resultDiv = document.getElementById('profitResult');
        const body = document.getElementById('profitBody');
        if (isNaN(num) || num <= 0) { resultDiv.style.display = 'none'; body.innerHTML = ''; return; }
        const now = new Date();
        const pastLimit = new Date();
        if (period === 'day') pastLimit.setDate(now.getDate() - num);
        else if (period === 'month') pastLimit.setMonth(now.getMonth() - num);
        else if (period === 'year') pastLimit.setFullYear(now.getFullYear() - num);
        const limitMs = pastLimit.getTime();
        let filtered = (user.logs || []).filter(l => l.id >= limitMs);
        if (currentProfitFilter !== 'all') { filtered = filtered.filter(l => l.type === currentProfitFilter); }
        let total = 0;
        filtered.forEach(l => { 
            let valStr = String(l.val).replace(/[+-]/g, '');
            let val = parseFloat(valStr);
            if(l.type === 'deposit') total += val; else total -= val;
        });
        resultDiv.style.display = 'block';
        resultDiv.style.background = total >= 0 ? '#eafaf1' : '#fdf2f2';
        resultDiv.style.color = total >= 0 ? 'var(--primary-color)' : 'var(--danger-color)';
        let prefix = "Ø§Ù„ØµØ§ÙÙŠ: ";
        if (currentProfitFilter === 'deposit') prefix = "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª: ";
        if (currentProfitFilter === 'withdraw') prefix = "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª: ";
        resultDiv.innerText = prefix + (currentProfitFilter === 'all' ? total.toFixed(3) : Math.abs(total).toFixed(3));
        body.innerHTML = filtered.map(l => `<tr><td>${l.day}</td><td class="log-date-full">${l.date}</td><td>${l.label}</td><td style="font-weight:bold; color:${l.type==='deposit'?'#27ae60':'#e74c3c'}">${l.tLabel}</td><td style="font-weight:bold; color:${l.type==='deposit'?'#27ae60':'#e74c3c'}">${l.val}</td></tr>`).join('');
    }

    function resetProfitCalc() { document.getElementById('profitVal').value = ''; setProfitFilter('all'); }

    function renderLogs() {
        const logs = user.logs || [];
        const filtered = logs.filter(l => { if(currentLogFilter === 'all') return true; return l.type === currentLogFilter; });
        document.getElementById('logBody').innerHTML = filtered.map(l => `<tr><td><div class="edit-cell ${l.desc ? 'has-desc' : ''}"><div class="dot"></div><span style="color:var(--accent-color); font-weight:bold; cursor:pointer; text-decoration:underline;" onclick="openEditNote(${l.id})">ØªØ­Ø±ÙŠØ±</span></div></td><td>${l.day}</td><td class="log-date-full">${l.date}</td><td>${l.label}</td><td style="font-weight:bold; color:${l.type==='deposit'?'#27ae60':'#e74c3c'}">${l.tLabel}</td><td style="font-weight:bold; color:${l.type==='deposit'?'#27ae60':'#e74c3c'}">${l.val}</td></tr>`).join('');
    }

    function openEditNote(id) { activeLogId = id; const entry = user.logs.find(x => x.id === id); document.getElementById('noteInput').value = entry.desc || ''; openModal('editNoteModal'); }

    function saveUser() { 
        const nInput = document.getElementById('newName');
        const p1Input = document.getElementById('newPin1');
        const p2Input = document.getElementById('newPin2');
        const p1 = p1Input.value.trim();
        const p2 = p2Input.value.trim();
        p1Input.classList.remove('input-error');
        p2Input.classList.remove('input-error');
        if(!nInput.value || !p1) { Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ù…Ø²', 'warning'); return; }
        const isDuplicate1 = db.some((u, index) => u.pin === p1 && (editingUserIdx === null || index !== editingUserIdx));
        if(isDuplicate1) { 
            p1Input.classList.add('input-error');
            Swal.fire({ icon: 'error', title: 'Ø®Ø·Ø£', text: 'ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø§Ø°Ø§ Ø§Ù„Ø±Ù…Ø² Ù…Ù† Ù‚Ø¨Ù„ Ù…Ø³ØªØ®Ø¯Ù… Ø§Ø®Ø± ÙŠØ±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø±Ù…Ø² Ø§Ø®Ø±' }); 
            return; 
        }
        if(p2) { 
            const isDuplicate2 = db.some((u, index) => u.pin2 === p2 && (editingUserIdx === null || index !== editingUserIdx));
            if(isDuplicate2) { 
                p2Input.classList.add('input-error');
                Swal.fire({ icon: 'error', title: 'Ø®Ø·Ø£', text: 'ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù‡Ø°Ø§ Ù…Ù† Ù‚Ø¨Ù„ Ù…Ø³ØªØ®Ø¯Ù… Ø¢Ø®Ø±ØŒ ÙŠØ±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø±Ù…Ø² Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø¢Ø®Ø±' }); 
                return; 
            }
        }
        if(editingUserIdx !== null) { 
            db[editingUserIdx].name = nInput.value; 
            db[editingUserIdx].pin = p1; 
            db[editingUserIdx].pin2 = p2; 
        } else { 
            const currentCats = (db[0] && db[0].cats) ? JSON.parse(JSON.stringify(db[0].cats)) : [];
            db.push({ name:nInput.value, pin:p1, pin2:p2, isAdmin:false, bal:0, inv:{}, logs:[], cats: currentCats, permissions:'control' }); 
        } 
        saveDB(); resetAdminForm(); renderAdmin(); 
    }

    function updateMyPin() { 
        const pInp = document.getElementById('updPin1'); 
        const p1 = pInp.value.trim();
        if(!p1) return;
        if(db.some(u => u !== user && u.pin === p1)) { 
            Swal.fire({ icon: 'error', title: 'Ø®Ø·Ø£', text: 'ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø§Ø°Ø§ Ø§Ù„Ø±Ù…Ø² Ù…Ù† Ù‚Ø¨Ù„ Ù…Ø³ØªØ®Ø¯Ù… Ø§Ø®Ø± ÙŠØ±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø±Ù…Ø² Ø§Ø®Ø±' }); 
            return; 
        }
        user.pin = p1; 
        saveDB(); 
        closeModal('changePinModal'); 
        pInp.value = ''; 
        Swal.fire({ icon: 'success', title: 'ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', text: 'ØªÙ… Ø­ÙØ¸ Ø±Ù…Ø²Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯', timer: 2000, showConfirmButton: false });
    }

    function addMoney(val, label) { 
        const currentPermission = remoteMode || (user.permissions || 'control');
        if (currentPermission === 'view' && !user.isAdmin) { Swal.fire({ icon: 'info', title: 'ØªÙ†Ø¨ÙŠÙ‡', text: 'ØªÙ… ØªØ¹ÙŠÙŠÙ†Ùƒ Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ­ÙƒÙ…' }); return; }
        if(!mode || !user) return; 
        const amt = Math.round(parseFloat(val) * 1000); 
        if(!user.inv) user.inv = {}; 
        if(!user.logs) user.logs = []; 
        let currentBal = Number(user.bal || 0); 
        if(mode === 'deposit') { user.bal = currentBal + amt; user.inv[label] = (Number(user.inv[label]) || 0) + 1; } 
        else { user.bal = currentBal - amt; user.inv[label] = (Number(user.inv[label]) || 0) - 1; } 
        const now = new Date(); 
        const days = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª']; 
        const dateStr = now.getDate() + "/" + (now.getMonth()+1) + "/" + now.getFullYear();
        user.logs.unshift({ 
            id: Date.now(), 
            desc: '', 
            day: days[now.getDay()], 
            date: dateStr, 
            label: label, 
            type: mode, 
            tLabel: mode === 'deposit' ? 'Ø¥ÙŠØ¯Ø§Ø¹' : 'Ø®ØµÙ…', 
            val: (mode==='deposit'?'+':'-')+parseFloat(val).toFixed(3) 
        }); 
        saveDB(); 
    }

    function updateUI() { if(user) { document.getElementById('totalDisplay').innerText = (Number(user.bal || 0) / 1000).toFixed(3); } }
    
    function renderMainGrid() { 
        const grid = document.getElementById('mainGrid');
        if(!user || !user.cats || user.cats.length === 0) { grid.innerHTML = "<p style='grid-column: span 2; color:#999; text-align:center; padding:40px 0;'>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¦Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>"; return; }
        grid.innerHTML = user.cats.map(c => `<div class="money-box" style="background:${c.color || '#fff'}" onclick="addMoney(${c.val}, '${c.label}')">${c.label}</div>`).join(''); 
    }

    function renderAdmin() { 
        document.getElementById('adminBody').innerHTML = db.map((u, i) => {
            const seenParts = (u.lastSeen || "-|-").split('|');
            return `<tr><td style="color:var(--accent-color); font-weight:bold; cursor:pointer;" onclick="startRemoteSession(${i}, 'view')">${u.name}</td><td>${((u.bal || 0)/1000).toFixed(3)}</td><td class="admin-seen-cell">${seenParts[0]}<span>${seenParts[1] || ''}</span></td><td>${u.isAdmin ? 'Ù…Ø¯ÙŠØ±' : `<select class="perm-select" onchange="updatePerm(${i}, this.value)"><option value="control" ${u.permissions==='control'?'selected':''}>ØªØ­ÙƒÙ…</option><option value="view" ${u.permissions==='view'?'selected':''}>Ù…Ø´Ø§Ù‡Ø¯Ø©</option></select>`}</td><td><button style="background:var(--warning-color); color:white; border:none; padding:6px 12px; border-radius:6px; cursor:pointer;" onclick="prepareEdit(${i})">ØªØ¹Ø¯ÙŠÙ„</button></td><td>${u.isAdmin ? '-' : `<button style="background:var(--danger-color); color:white; border:none; padding:6px 12px; border-radius:6px; cursor:pointer;" onclick="deleteUser(${i})">Ø­Ø°Ù</button>`}</td></tr>`;
        }).join('');
    }

    function startRemoteSession(idx, type) { originalAdmin = user; user = db[idx]; remoteMode = type; document.getElementById('returnBar').style.display = 'block'; document.getElementById('userTitle').innerText = "Ù…Ø´Ø§Ù‡Ø¯Ø©: " + user.name; closeModal('adminModal'); updateUI(); renderMainGrid(); }
    function stopRemoteSession() { user = originalAdmin; originalAdmin = null; remoteMode = null; document.getElementById('returnBar').style.display = 'none'; document.getElementById('userTitle').innerText = "Ù…Ø­ÙØ¸Ø©: " + user.name; updateUI(); renderMainGrid(); }
    function updatePerm(idx, val) { db[idx].permissions = val; saveDB(); }
    function prepareEdit(i) { editingUserIdx = i; document.getElementById('newName').value = db[i].name; document.getElementById('newPin1').value = db[i].pin; document.getElementById('newPin2').value = db[i].pin2; document.getElementById('formTitle').innerText = "âœ ØªØ¹Ø¯ÙŠÙ„: " + db[i].name; document.getElementById('adminSubmitBtn').innerText = "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"; document.getElementById('cancelEditBtn').style.display = "block"; }
    function resetAdminForm() { editingUserIdx = null; document.getElementById('newName').value = ''; document.getElementById('newPin1').value = ''; document.getElementById('newPin2').value = ''; document.getElementById('formTitle').innerText = "+ Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯"; document.getElementById('adminSubmitBtn').innerText = "Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"; document.getElementById('cancelEditBtn').style.display = "none"; }
    function renderInv() { if(!user.cats) return; document.getElementById('invBody').innerHTML = user.cats.map(c => { const count = user.inv ? (Number(user.inv[c.label]) || 0) : 0; return `<tr><td>${c.label}</td><td>${count}</td><td>${(count * parseFloat(c.val)).toFixed(3)}</td></tr>`; }).join(''); }
    function showColorPicker(idx) { let gridHtml = '<div class="color-grid">'; presetColors.forEach((color, i) => { gridHtml += `<div class="color-box" style="background:${color}" onclick="setCategoryColor(${idx}, '${color}')">${i + 1}</div>`; }); gridHtml += '</div>'; Swal.fire({ title: 'Ø§Ø®ØªØ± Ù„ÙˆÙ†Ø§Ù‹', html: gridHtml, showDenyButton: true, confirmButtonText: 'Ø¥Ù„ØºØ§Ø¡', denyButtonText: 'Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ' }).then((result) => { if (result.isDenied) setCategoryColor(idx, '#ffffff'); }); }
    function setCategoryColor(idx, color) { const targetLabel = user.cats[idx].label; db.forEach(u => { if(u.cats) { const c = u.cats.find(x => x.label === targetLabel); if(c) c.color = color; } }); saveDB(); Swal.close(); }
    function renderCustList() { const list = document.getElementById('custListBody'); if(!user.cats || user.cats.length === 0) { list.innerHTML = "<p style='text-align:center; color:#999;'>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¦Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§</p>"; return; } list.innerHTML = user.cats.map((c, i) => `<div class="cust-item"><span>${c.label}</span><div class="move-btns"><button onclick="moveCat(${i}, -1)">â†‘</button><button onclick="moveCat(${i}, 1)">â†“</button><button onclick="showColorPicker(${i})" style="background:var(--warning-color); color:white; border:none; padding:5px 10px; border-radius:5px;">Ù„ÙˆÙ†</button><button onclick="deleteCat(${i})" style="color:red; border-color:red;">Ø­Ø°Ù</button></div></div>`).join(''); }
    function deleteAllCats() { Swal.fire({ title: 'Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§ØªØŸ', text: "Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø§Ù„ÙØ¦Ø§Øª Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ø´ÙƒÙ„ Ù†Ù‡Ø§Ø¦ÙŠ!", icon: 'error', showCancelButton: true, confirmButtonColor: '#d33', confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø­Ø°Ù Ù…Ù† Ø§Ù„ÙƒÙ„', cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡' }).then(r => { if(r.isConfirmed){ db.forEach(u => { u.cats = []; }); saveDB(); Swal.fire('ØªÙ… Ø§Ù„Ø­Ø°Ù', 'ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª', 'success'); } }); }
    function addNewCategory() { const vInput = document.getElementById('custValue'); if(!vInput.value) return; let num = parseFloat(vInput.value); let val = (selectedUnit === 'Ø¨ÙŠØ³Ø©') ? num / 1000 : num; let label = (selectedUnit === 'Ø¨ÙŠØ³Ø©') ? num + " Ø¨ÙŠØ³Ø©" : num + " Ø±ÙŠØ§Ù„"; db.forEach(u => { if(!u.cats) u.cats = []; if (!u.cats.find(c => c.label === label)) { u.cats.push({label: label, val: val, color: '#ffffff'}); } }); saveDB(); vInput.value = ''; }
    function deleteCat(i) { Swal.fire({title:'Ø­Ø°Ù Ø§Ù„ÙØ¦Ø© Ù…Ù† Ø§Ù„Ø¬Ù…ÙŠØ¹ØŸ', icon:'warning', showCancelButton:true, confirmButtonText:'Ù†Ø¹Ù…'}).then(r=>{ if(r.isConfirmed){ const targetLabel = user.cats[i].label; db.forEach(u => { if(u.cats) u.cats = u.cats.filter(c => c.label !== targetLabel); }); saveDB(); } }); }
    function moveCat(i, s) { let ni = i + s; if (ni >= 0 && ni < user.cats.length) { const targetLabel1 = user.cats[i].label; const targetLabel2 = user.cats[ni].label; db.forEach(u => { if(u.cats) { const idx1 = u.cats.findIndex(c => c.label === targetLabel1); const idx2 = u.cats.findIndex(c => c.label === targetLabel2); if(idx1 !== -1 && idx2 !== -1) { [u.cats[idx1], u.cats[idx2]] = [u.cats[idx2], u.cats[idx1]]; } } }); saveDB(); } }
    function toggleUnit() { selectedUnit = (selectedUnit === 'Ø±ÙŠØ§Ù„') ? 'Ø¨ÙŠØ³Ø©' : 'Ø±ÙŠØ§Ù„'; document.getElementById('currentUnit').innerText = selectedUnit; }
    function changeMode(m) { mode = m; document.getElementById('btnDep').className = 'btn-small' + (m==='deposit'?' active-deposit':''); document.getElementById('btnWith').className = 'btn-small' + (m==='withdraw'?' active-withdraw':''); }
    function toggleMenu() { const m = document.getElementById('mainMenu'); m.style.display = (m.style.display==='block'?'none':'block'); }
    function openModal(id) { document.getElementById(id).style.display='block'; if(id!=='editNoteModal') toggleMenu(); }
    function closeModal(id) { document.getElementById(id).style.display='none'; if(id === 'adminModal') resetAdminForm(); }
    function showBackup() { document.getElementById('loginScreen').style.display='none'; document.getElementById('backupLoginScreen').style.display='flex'; }
    function hideBackup() { document.getElementById('backupLoginScreen').style.display='none'; document.getElementById('loginScreen').style.display='flex'; }
    function showSupportMsg() { document.getElementById('supportMsg').style.display='block'; }
    function confirmResetWallet() { 
        const currentPermission = remoteMode || (user.permissions || 'control'); 
        if (currentPermission === 'view' && !user.isAdmin) { Swal.fire({ icon: 'info', title: 'ØªÙ†Ø¨ÙŠÙ‡', text: 'ØªÙ… ØªØ¹ÙŠÙŠÙ†Ùƒ Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ­ÙƒÙ…' }); return; } 
        Swal.fire({ title: 'ØªØµÙÙŠØ± Ø§Ù„Ù…Ø­ÙØ¸Ø©ØŸ', text: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØµÙÙŠØ± Ø§Ù„Ù…Ø­ÙØ¸Ø©ØŸ Ø³ØªÙÙ‚Ø¯ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ!", icon: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Ù†Ø¹Ù…', cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡', customClass: { confirmButton: 'swal-pulse-confirm', cancelButton: 'swal-pulse-cancel' } }).then((result) => { 
            if (result.isConfirmed) { user.bal = 0; user.logs = []; user.inv = {}; saveDB(); toggleMenu(); Swal.fire({ title: 'ØªÙ… Ø§Ù„ØªØµÙÙŠØ±!', text: 'ØªÙ… Ù…Ø³Ø­ ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.', icon: 'success', timer: 1500, showConfirmButton: false }); } 
        }); 
    }
    function deleteUser(i) { Swal.fire({title:'Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù…ØŸ', icon:'question', showCancelButton:true}).then(r=>{ if(r.isConfirmed){ db.splice(i, 1); saveDB(); renderAdmin(); } }); }
    function saveNote() { const entry = user.logs.find(x => x.id === activeLogId); if(entry) { entry.desc = document.getElementById('noteInput').value; saveDB(); renderLogs(); closeModal('editNoteModal'); } }
</script>
</body>
</html>
